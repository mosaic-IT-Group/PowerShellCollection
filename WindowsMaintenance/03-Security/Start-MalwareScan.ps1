#Requires -RunAsAdministrator
<#
.SYNOPSIS
    Runs Windows Defender malware scan.
.DESCRIPTION
    Initiates a quick or full scan using Windows Defender.
#>

[CmdletBinding()]
param(
    [ValidateSet('Quick', 'Full', 'Custom')]
    [string]$ScanType = 'Quick',
    [string]$CustomPath
)

# Update definitions first
Write-Host "Updating malware definitions..."
Update-MpSignature -ErrorAction SilentlyContinue

Write-Host "Starting $ScanType scan..."

switch ($ScanType) {
    'Quick' {
        Start-MpScan -ScanType QuickScan
    }
    'Full' {
        Start-MpScan -ScanType FullScan
    }
    'Custom' {
        if (-not $CustomPath) {
            Write-Error "CustomPath required for Custom scan type."
            exit 1
        }
        Start-MpScan -ScanType CustomScan -ScanPath $CustomPath
    }
}

# Get recent threats
$Threats = Get-MpThreatDetection | Where-Object { $_.InitialDetectionTime -gt (Get-Date).AddDays(-1) }

if ($Threats) {
    Write-Warning "Recent threats detected:"
    $Threats | Select-Object ThreatID, ProcessName, InitialDetectionTime
}
else {
    Write-Host "No recent threats detected."
}
